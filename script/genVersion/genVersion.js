!function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=5)}([function(e,t){e.exports=require("path")},function(e,t,r){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const i=n(r(3));t.readdir=function(e){return new Promise((t,r)=>{i.readdir(e,(e,n)=>{if(e)return r(e);t(n)})})},t.readFile=async function(e){return new Promise((t,r)=>{i.readFile(e,"utf8",(e,n)=>{if(e)return r(e);t(n)})})},t.exists=function(e){return new Promise((t,r)=>{i.exists(e,e=>{t(e)})})},t.lstatFile=function(e){return new Promise((t,r)=>{i.lstat(e,(e,n)=>e?r(e):t(n))})},t.rmdir=function(e){return new Promise((t,r)=>{i.rmdir(e,e=>{if(e)return r(e);t()})})},t.unlink=function(e){return new Promise((t,r)=>{i.unlink(e,e=>{if(e)return r(e);t()})})},t.mkdir=function(e){return new Promise((t,r)=>{i.mkdir(e,e=>{!e||e&&e.code,t()})})},t.sleep=function(e){return new Promise((t,r)=>{setTimeout(()=>{t()},e)})}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(1);t.intConfig=async function(e){const r=await n.readFile(e),i=JSON.parse(r);t.project_folder=i.project_folder,t.bin_js=i.bin_js,t.bin_res=i.bin_res,t.exclude_files=i.exclude,t.laya_assets=i.laya_assets,t.laya_pages=i.laya_pages,t.include=i.include,t.bin=i.bin,t.version_pos=i.version_pos}},function(e,t){e.exports=require("fs")},function(e,t,r){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const i=n(r(0)),o=r(1),s="/";function u(e){return(e=i.normalize(e)).replace(/\\$/,"").replace(/\\/g,"/")}t.normalize=u,t.calcClosestDepth=function e(t,r){t=u(t);const n=u(r);return n===t?0:-1===t.indexOf(n+s)?-1:1+e(i.resolve(t,".."),r)},t.getFileInfo=async function(e){const t=await o.lstatFile(e);let r,n,s,u;return t.isDirectory()?(r="directory",s=i.basename(e),u=i.resolve(e,"..")):t.isFile()&&(r="file",n=i.extname(e),s=i.basename(e).replace(n,""),u=i.dirname(e)),{type:r,name:s,parent:u,ext:n}}},function(e,t,r){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const i=n(r(0)),o=r(2),s=r(6),u=process.argv.slice(2)[0]||"genVersion",a=i.resolve(i.dirname(process.argv[1]),"./config.json");!async function(){console.time("costTime"),await o.intConfig(a);const e={genVersion:s.genVersion};e[u]&&await e[u](),console.timeEnd("costTime")}()},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const o=n(r(7)),s=i(r(0)),u=r(2),a=r(4),c=r(8),l=r(10),f=r(13);async function d(e){return new Promise((t,r)=>{e=s.resolve(u.project_folder,e),o.default(e,(e,n)=>{if(e)return r(e);n=n.substr(0,8),t(n)})})}t.genVersion=async function(){const e={},t=await l.findBinFiles();for(const r of t){const t=await d(r);e[a.normalize(s.relative(u.bin,r))]=t}const r=s.resolve(u.project_folder,u.version_pos,"version.json");c.write(r,f.stringify(e))}},function(e,t){e.exports=require("md5-file")},function(e,t,r){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const i=n(r(3)),o=n(r(0)),s=r(1),u=r(9);t.write=async function(e,t){const r=o.dirname(e);await s.exists(r)||await u.mk(r),await new Promise((r,n)=>{i.writeFile(e,t,e=>{if(e)return n(e);r()})})}},function(e,t,r){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const i=n(r(0)),o=r(1);t.mk=async function(e){if(await o.exists(e))return!0;const t=(e=i.normalize(e)).split(i.sep);for(let e=0;e<t.length;e++){if(!t[e])continue;const r=t.slice(0,e+1).join(i.sep);await o.exists(r)||await o.mkdir(r)}}},function(e,t,r){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const i=n(r(0)),o=r(2),s=r(1),u=r(4),a=r(11);async function c(){const e=(await a.execArr("git ls-tree --full-tree -r HEAD",{path:o.project_folder})).split("\n");e.pop();const t=[];for(const r of e){const e=r.split(/\s+/);t.push(e[e.length-1])}return t}async function l(e){const t=await async function(e){if(0===e.indexOf(`${o.bin}/`)&&await s.exists(i.resolve(o.project_folder,e)))return e;if(0===e.indexOf(o.laya_assets)){const t=e.replace(o.laya_assets,o.bin);if(await s.exists(i.resolve(o.project_folder,t)))return t}if(0===e.indexOf(o.laya_pages)){const t=e.replace(o.laya_pages,o.bin);if(await s.exists(i.resolve(o.project_folder,t)))return t}const t=i.dirname(e.replace(o.laya_assets,o.bin_res)),r=`${t}.atlas`,n=`${t}.json`,u=`${t}.png`;if(await s.exists(i.resolve(o.project_folder,n)))return[n,u];if(await s.exists(i.resolve(o.project_folder,r)))return[r,u]}(e);if(t)return t;if(function(e){if(e.match(/(\.ts|\.js|\.json)$/))return!0;if(e.match(/^src/))return!0;if(e.match(/^libs/))return!0;if(e.match(/^test/))return!0;return!1}(e)||function(e){if(e.match(/^laya\/pages\//))return!0;return!1}(e))return[o.bin_js];throw new Error(`cant find target file for ${e}`)}function f(e){if(e=i.resolve(o.project_folder,e),o.exclude_files){for(let t of o.exclude_files)if(t=i.resolve(o.project_folder,t),u.calcClosestDepth(e,t)>-1)return!0;return!1}return!1}function d(e){if(e=i.resolve(o.project_folder,e),o.include){for(let t of o.include)if(t=i.resolve(o.project_folder,t),u.calcClosestDepth(e,t)>-1)return!0;return!1}return!0}t.findBinFiles=async function(){const e=await c();let t=[];for(const r of e)if(!f(r)&&d(r))try{const e=await l(r);Array.isArray(e)?t=t.concat(e):t.push(e)}catch(e){console.error(e)}return t=t.filter((e,r)=>t.indexOf(e)===r)},t.findOriAllFiles=c},function(e,t,r){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const i=n(r(12)),{exec:o}=i;function s(e,t){const{path:r,output:n}=t,i={maxBuffer:104857600,encoding:"utf-8"};return r&&(i.cwd=r),new Promise((t,r)=>{let s="",u="";const a=o(e,i);n&&(a.stdout.pipe(process.stdout),a.stderr.pipe(process.stderr)),a.stdout.on("data",e=>{s+=e}),a.stderr.on("data",e=>{u+=e}),a.on("exit",e=>{t(0===e?s:u)})})}t.execArr=async function(e,t){if(!Array.isArray(e))return await s(e,t);const r=[];for(const n of e){const e=await s(n,t);r.push(e)}return r}},function(e,t){e.exports=require("child_process")},function(e,t,r){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const i=n(r(14));function o(e,t,r=1){return 0===t||t<0?s(e):i.isArray(e)?function(e,t,r=1){if(0===t)return s(e);let n="[\n";const i="  ";for(let s=0;s<e.length;s++)n+=i.repeat(r),n+=o(e[s],t-1,r+1),s!==e.length-1&&(n+=","),n+="\n";return n+=i.repeat(r-1),n+="]"}(e,t,r):i.isObject(e)?function(e,t,r=1){if(0===t)return s(e);let n="{\n";const i="  ";r=r||1;let u=Object.keys(e);u=u.filter(t=>void 0!==e[t]);for(let s=0;s<u.length;s++){const a=u[s],c=e[a];n+=i.repeat(r),n+=`"${a}": ${o(c,t-1,r+1)}`,s!==u.length-1&&(n+=","),n+="\n"}return n+=i.repeat(r-1),n+="}"}(e,t,r):s(e)}function s(e){return void 0===e&&(e=null),JSON.stringify(e)}t.stringify=o,t.log=function(...e){console.log(...e)},t.setProps=function(e,t){for(let r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},t.getXArr=function(e,t){const r=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],n=[];let i="",o=0,s=!1,u=!1;for(;;){for(const o of r){const r=i+o;if(r===e&&(s=!0),s&&n.push(r),r===t){u=!0;break}}if(u)break;i=r[o],o++}return n},t.getYArr=function(e,t){const r=[];for(let n=e;n<=t;n++)r.push(n);return r}},function(e,t){e.exports=require("lodash")}]);